# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG –ú–æ–¥—É–ª—è üî¨

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-12-21  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  

---

## üìä –û–±–∑–æ—Ä

–ù–∞–≥–ª—è–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG –º–æ–¥—É–ª—è:

```
–í–•–û–î (–î–æ–∫—É–º–µ–Ω—Ç)
    ‚Üë
    FileProcessor          ‚Üí –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç
    ‚Üë
    Chunker                ‚Üí –†–∞–∑–±–∏—Ç—å –Ω–∞ –∫—É—Å–∫–∏
    ‚Üë
    EmbeddingService       ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã
    ‚Üë
    ChromaVectorStore      ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
    ‚Üë
    RAGManager             ‚Üí –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å

üîç –ü–û–ò–°–ö (–í–æ–ø—Ä–æ—Å)
    ‚Üë
    EmbeddingService       ‚Üí –≠–º–±–µ–¥ –≤–æ–ø—Ä–æ—Å
    ‚Üë
    Retriever              ‚Üí –ù–∞–π—Ç–∏ —Å–∏–º–∏–ª—è—Ä–Ω—ã–µ —á–∞—Å—Ç–∏
    ‚Üë
    –û—Ç–≤–µ—Ç—ã
```

---

## üêú 6 –ö–æ—Ä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. FileProcessor - –ü–∞—Ä—Å–∏–Ω–≥ –§–∞–π–ª–æ–≤ üìÑ

**–¢–∞—Å–∫:** –û—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç

| –§–æ—Ä–º–∞—Ç | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –ü—Ä–æ—Ü–µ—Å—Å |
|---------|-----------|----------|
| **PDF** | PyPDF2 | –ü–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| **DOCX** | python-docx | –≠–∫—Å—Ç—Ä–∞–∫—Ç –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ |
| **TXT** | –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ | –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å |

**–í—ã—Ö–æ–¥:** –û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

```python
class FileProcessor:
    async def extract_text(self, file_path: Path) -> str:
        """–≠–∫—Å—Ç—Ä–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞."""
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø
        # –í—ã–∑–≤–∞—Ç—å –Ω—É–∂–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        # –í–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç
```

### 2. Chunker - –†–∞–∑–±–∏–≤–∫–∞ –ù–∞ –ö—É—Å–∫–∏ ‚úÇÔ∏è

**–¢–∞—Å–∫:** –†–∞–∑–¥–µ–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –º–∞–Ω–µ–∂–∏—Ä—É–µ–º—ã–µ –∫—É—Å–∫–∏

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```
1. –†–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (–ï–ù–õ)
2. –ï—Å–ª–∏ –∫—É—Å–æ–∫ > 500 —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
3. –ï—Å–ª–∏ –∫—É—Å–æ–∫ > 500 —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ —Å–ª–æ–≤–∞–º
4. –î–æ–±–∞–≤–∏—Ç—å 50 —Ç–æ–∫–µ–Ω–æ–≤ overlap –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
5. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (ID, –ø–æ–∑–∏—Ü–∏—è, —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
```

**–í—ã—Ö–æ–¥:** List[Chunk] - –ö—É—Å–∫–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

### 3. EmbeddingService - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ üß†

**–ú–æ–¥–µ–ª—å:** `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2`
- **–†–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞:** 384 –¥–∏–º–µ–Ω—Å–∏–∏
- **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å:** –¥–∞ (—Ä—É—Å, –∞–Ω–≥, –∫–∏—Ç–∞–π –∏ –¥—Ä.)
- **–ù–∞–≥—Ä—É–∑–æ–∫:** ~130–ú–ë
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~1000 —Ç–µ–∫—Å—Ç–æ–≤/—Å–µ–∫

**–û–ø–µ—Ä–∞—Ü–∏–∏:**
```python
# –û–¥–∏–Ω —Ç–µ–∫—Å—Ç
embedding = embedder.embed_text(text)  # 384D vector

# –ë–∞—Ç—á —Ç–µ–∫—Å—Ç–æ–≤
embeddings = embedder.embed_batch(texts, batch_size=32)  # –ú–∞—Ç—Ä–∏—Ü–∞
```

### 4. ChromaVectorStore - –•—Ä–∞–Ω–∏–ª–∏—â–µ –í–µ–∫—Ç–æ—Ä–æ–≤ üíæ

**–ë–î:** ChromaDB (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è)

**–û–ø–µ—Ä–∞—Ü–∏–∏:**
```python
# –î–æ–±–∞–≤–∏—Ç—å –∫—É—Å–∫–∏
await store.add_chunks(chunks)  # –° embeddings

# –ü–æ–∏—Å–∫
results = await store.search(
    query_embedding,
    top_k=5,
    threshold=0.3
)

# –£–¥–∞–ª–∏—Ç—å
await store.delete(doc_id)
```

**–ú–µ—Ç—Ä–∏–∫–∞ –ø–æ–∏—Å–∫–∞:** Cosine similarity (0 = –æ–ø–ø–æ–∑–∏—Ç–Ω—ã–µ, 1 = –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ)

### 5. Retriever - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ü–æ–∏—Å–∫ üß†

**–¢–∞—Å–∫:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å embeddings + vector store –¥–ª—è —ç–Ω–¥-—Ç—É-—ç–Ω–¥ –ø–æ–∏—Å–∫–∞

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```
1. –≠–º–±–µ–¥ –≤–æ–ø—Ä–æ—Å (embedding service)
2. –ù–∞–π—Ç–∏ —Å–∏–º–∏–ª—è—Ä–Ω—ã–µ —á–∞—Å—Ç–∏ (vector store)
3. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—á–µ—Å—Ç–≤—É
4. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä–æ–≥—É —Å–∏–º–∏–ª—è—Ä–Ω–æ—Å—Ç–∏
5. –û—Ñ–æ—Ä–º–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### 6. RAGManager - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä üéõÔ∏è

**–¢–∞—Å–∫:** –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**API:**
```python
manager = RAGManager()

# –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
await manager.add_document(
    file_path="contract.pdf",
    doc_id="doc_2024_01"
)

# –ü–æ–∏—Å–∫
results = await manager.search(
    query="–ö–∞–∫–∏–µ —Å—Ä–æ–∫–∏ –æ–ø–ª–∞—Ç—ã?",
    top_k=3
)

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
await manager.delete_document(doc_id)
await manager.clear_all()
```

---

## üíæ –ú–æ–¥–µ–ª–∏ –î–∞–Ω–Ω—ã—Ö

```python
@dataclass
class Document:
    """Document metadata."""
    id: str                    # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    title: str                 # –ì–æ–ª–æ–≤–Ω–∞—è
    file_path: Path            # –ü–æ–ª–Ω—ã–π –ø—É—Ç—å
    file_size: int             # –û—Ä–∏–≥ —Ä–∞–∑–º–µ—Ä
    created_at: datetime       # –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω
    chunk_count: int           # –ö–æ–ª–≤–æ –∫—É—Å–∫–æ–≤
    metadata: dict             # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞

@dataclass
class Chunk:
    """Document chunk."""
    id: str                    # Unique chunk ID
    doc_id: str                # –ö–∞–∫–æ–µ –¥–æ–∫–∏
    text: str                  # –¢–µ–∫—Å—Ç –∫—É—Å–∫–∞
    embedding: List[float]     # 384D –≤–µ–∫—Ç–æ—Ä
    position: int              # –ü–æ–∑–∏—Ü–∏—è –≤ –¥–æ–∫
    page: int | None           # –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    metadata: dict             # Custom –Ω–∞–¥–∞–Ω–Ω—ã–µ

@dataclass
class SearchResult:
    """Search result."""
    chunk: Chunk               # –ù–∞–π–¥–µ–Ω–Ω—ã–π –∫—É—Å–æ–∫
    similarity_score: float    # 0-1 –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω
    source_doc: str            # –û—Ä–∏–≥ –¥–æ–∫—É–º–µ–Ω—Ç
```

---

## üìÑ –ü–æ–ø–æ–ª—å—á–µ–Ω–∏–µ –î–∞–Ω–Ω—ã—Ö

**–¢–æ–ø–æ–ª–æ–≥–∏—è –ø—Ä–æ—Å—Ç–∞—è - –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω–æ:**

```
data/
‚îú‚îÄ‚îÄ vector_db/            # ChromaDB
‚îÇ   ‚îú‚îÄ‚îÄ chroma.db        # –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞ –±–¥ –∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ embeddings/     # –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å—Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îî‚îÄ‚îÄ metadata.json   # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ documents/        # –£–∫–µ
‚îú‚îÄ‚îÄ logs/             # –õ–æ–≥–∏
‚îî‚îÄ‚îÄ cache/            # –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —ç–º–±–µ–¥–∏–Ω–≥
```

---

## üîö –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫

**–ò–µ—Ä–∞—Ä—Ö–∏—è:**

```
RAGException (–±–∞–∑–æ–≤—ã–µ)
  ‚îú‚îÄ‚îÄ FileProcessingError
  ‚îú‚îÄ‚îÄ ChunkingError
  ‚îú‚îÄ‚îÄ EmbeddingError
  ‚îú‚îÄ‚îÄ VectorStoreError
  ‚îú‚îÄ‚îÄ RetrieverError
  ‚îî‚îÄ‚îÄ ConfigurationError
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
- –í—Å–µ–≥–¥–∞ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- –ü–µ—Ä–µ–¥–∞—Ç—å –≤—Å—é –∏–Ω—Ñ–æ —É—Ä–æ–≤–Ω—é –≤—ã—à–µ
- –ù–µ –º–æ–ª–æ—á–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-21

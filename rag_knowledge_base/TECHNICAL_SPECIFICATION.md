# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: RAG –º–æ–¥—É–ª—å –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π üìù

**–í–µ—Ä—Å–∏—è:** 1.0.0 (–û–ë–ù–û–í–õ–ï–ù–û)  
**–°—Ç–∞—Ç—É—Å:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ, –≥–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-21  
**–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω  

---

## üìã –†–µ–∑—é–º–µ

RAG (Retrieval-Augmented Generation) –º–æ–¥—É–ª—å - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è, production-ready —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞, –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º–∞—è —Å TG_bot Telegram –±–æ—Ç–æ–º.

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1000+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –≠–∫–æ–Ω–æ–º–∏—è 85-90% —Ç–æ–∫–µ–Ω–æ–≤ vs –Ω–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- –ü–æ–∏—Å–∫ < 200ms
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF, DOCX, DOC, XLSX, XLS, TXT, ZIP
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ embeddings

---

## 1Ô∏è‚É£ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1.1 User Stories

#### US-1: –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É** –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOCX, TXT, ZIP)  
**–ß—Ç–æ–±—ã** –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [x] PDF –¥–æ 50MB
- [x] DOCX –¥–æ 50MB
- [x] TXT –¥–æ 10MB
- [x] ZIP —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- [ ] ID –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –∫–æ–ª-–≤–æ chunks

#### US-2: –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É** –∏—Å–∫–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º  
**–ß—Ç–æ–±—ã** –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±—ã—Å—Ç—Ä–æ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
- [ ] –í–æ–∑–≤—Ä–∞—Ç top 5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö chunks
- [ ] –û—Ü–µ–Ω–∫–∏ —Å—Ö–æ–¥—Å—Ç–≤–∞ (0-100%)
- [ ] –ò–º—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ, –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∏ –¥—Ä.
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã < 2 —Å–µ–∫
- [ ] –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

#### US-3: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É** –≤–∏–¥–µ—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –±–∞–∑–µ  
**–ß—Ç–æ–±—ã** —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–ø–∏—Å–æ–∫ —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- [ ] –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞, –¥–∞—Ç–∞, –∫–æ–ª-–≤–æ chunks
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ, —Ä–∞–∑–º–µ—Ä—É, –∏–º–µ–Ω–∏
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø–æ–∏—Å–∫—É

#### US-4: –£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É** —É–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç  
**–ß—Ç–æ–±—ã** —É–ø—Ä–∞–≤–ª—è—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ ID
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö chunks –¥–æ–∫—É–º–µ–Ω—Ç–∞
- [ ] –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- [ ] –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

#### US-5: –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É
**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–•–æ—á—É** —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å—Ä–∞–∑—É  
**–ß—Ç–æ–±—ã** –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞ —Ä–∞–∑
- [ ] –¢—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- [ ] –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

## 2Ô∏è‚É£ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

### 2.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

```
–í–•–û–î (–î–æ–∫—É–º–µ–Ω—Ç)
    ‚Üì
[‚úÖ FileProcessor]     ‚Üí –ü–æ–¥–¥–µ—Ä–∂–∫–∞: PDF, DOCX, DOC, XLSX, XLS, TXT, ZIP
    ‚Üì
[‚úÖ Chunker]           ‚Üí –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ 500-token chunks —Å overlap
    ‚Üì
[? EmbeddingService]   ‚Üí Sentence-Transformers (384D vectors)
    ‚Üì
[? VectorStore]        ‚Üí ChromaDB (persistent)
    ‚Üì
[? RAGManager]         ‚Üí –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è

–ü–û–ò–°–ö (–í–æ–ø—Ä–æ—Å)
    ‚Üì
[? EmbeddingService]   ‚Üí –≠–º–±–µ–¥–∏—Ç—å –≤–æ–ø—Ä–æ—Å
    ‚Üì
[? Retriever]          ‚Üí –ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ
    ‚Üì
–û—Ç–≤–µ—Ç—ã
```

### 2.2 –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã File Processing ‚úÖ

#### FileConverter (–≥–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
```python
class FileConverter:
    """–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –∫ –Ω—É–∂–Ω—ã–º –ø–∞—Ä—Å–µ—Ä–∞–º."""
    
    def extract_text(file_path: Path) -> str:
        # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
| –§–æ—Ä–º–∞—Ç | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –°—Ç–∞—Ç—É—Å |
|--------|-----------|--------|
| PDF | PyPDF2 | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| DOCX | python-docx | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| DOC | aspose.words | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| XLSX | openpyxl | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| XLS | xlrd | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| TXT | –≤—Å—Ç—Ä–æ–µ–Ω–æ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| ZIP | zipfile | ‚úÖ –ì–æ—Ç–æ–≤–æ + Security |

#### PDFParser ‚úÖ
```python
class PDFParser:
    """–ü–∞—Ä—Å–∏—Ç PDF –∏—Å–ø–æ–ª—å–∑—É—è pypdf."""
    - extract_text(file_path) ‚Üí str
    - get_metadata(file_path) ‚Üí dict
```

#### DOCXParser ‚úÖ
```python
class DOCXParser:
    """–ü–∞—Ä—Å–∏—Ç DOCX (–¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç DOCParser –¥–ª—è .doc)."""
    - extract_text(file_path) ‚Üí str
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∞–±–ª–∏—Ü
    - get_metadata() ‚Üí dict
```

#### DOCParser ‚úÖ
```python
class DOCParser:
    """–ü–∞—Ä—Å–∏—Ç —Å—Ç–∞—Ä—ã–µ .doc —á–µ—Ä–µ–∑ Aspose.Words."""
    - extract_text(file_path) ‚Üí str
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ (CP1251)
```

#### ExcelParser ‚úÖ
```python
class ExcelParser:
    """–ü–∞—Ä—Å–∏—Ç XLSX (openpyxl) –∏ XLS (xlrd)."""
    - extract_text(file_path) ‚Üí str
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤
    - –¢–∞–±–ª–∏—Ü—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ "cell1 | cell2 | ..."
```

#### TextCleaner ‚úÖ
```python
class TextCleaner:
    """–û—á–∏—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç –º—É—Å–æ—Ä–∞ –∏ control characters."""
    - clean_extracted_text(text) ‚Üí str
    - –£–¥–∞–ª–µ–Ω–∏–µ control chars
    - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤
    - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É—Å–æ—Ä–∞
    - is_text_usable(text) ‚Üí bool
```

#### ZIPHandler ‚úÖ
```python
class ZIPHandler:
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ ZIP —Å –∑–∞—â–∏—Ç–æ–π."""
    - validate_archive(file_path) ‚Üí bool
    - extract_supported_files(file_path) ‚Üí list[Path]
    - Protection –æ—Ç zip bombs –∏ path traversal
```

### 2.3 –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

#### Chunker üîÑ
```python
class Chunker:
    """–†–∞–∑–±–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ 500-token chunks —Å overlap."""
    - chunk_text(text: str) ‚Üí List[Chunk]
    - –ê–ª–≥–æ—Ä–∏—Ç–º: –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã ‚Üí –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Üí —Å–ª–æ–≤–∞
    - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –ø–æ–∑–∏—Ü–∏—è, —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∏—Å—Ç–æ—á–Ω–∏–∫
```

#### EmbeddingService üîÑ
```python
class EmbeddingService:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 384D embeddings —á–µ—Ä–µ–∑ Sentence-Transformers."""
    - embed_text(text: str) ‚Üí List[float]
    - embed_batch(texts: List[str]) ‚Üí np.ndarray
    - –ú–æ–¥–µ–ª—å: paraphrase-multilingual-MiniLM-L12-v2
```

#### ChromaVectorStore üîÑ
```python
class ChromaVectorStore:
    """–•—Ä–∞–Ω–∏–ª–∏—â–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ ChromaDB."""
    - add_chunks(chunks: List[Chunk]) ‚Üí None
    - search(query_embedding) ‚Üí List[SearchResult]
    - delete(doc_id) ‚Üí None
    - –ú–µ—Ç—Ä–∏–∫–∞: cosine similarity
```

#### Retriever üîÑ
```python
class Retriever:
    """–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ embeddings + vector store."""
    - retrieve(query: str, top_k: int) ‚Üí List[SearchResult]
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
```

#### RAGManager üîÑ
```python
class RAGManager:
    """–ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤."""
    - add_document(file_path) ‚Üí DocumentInfo
    - search(query: str) ‚Üí List[SearchResult]
    - delete_document(doc_id) ‚Üí None
    - list_documents() ‚Üí List[DocumentInfo]
    - clear_all() ‚Üí None
```

---

## 3Ô∏è‚É£ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–ò

### 3.1 –§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤ (‚úÖ –ì–û–¢–û–í–û)

**–í—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- ‚úÖ PDF: PyPDF2, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ DOCX: python-docx, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ DOC: aspose.words, –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
- ‚úÖ XLSX/XLS: openpyxl + xlrd, —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ TXT: raw —Ç–µ–∫—Å—Ç
- ‚úÖ ZIP: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç:**
- –û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å —Ä–∞–∑–º–µ—Ä: 50MB
- –ú–∞–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: 10,000
- –Ø–∑—ã–∫–∏: UTF-8

### 3.2 Chunking (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```
1. –†–∞–∑–±–∏—Ç—å –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (\n\n)
2. –ï—Å–ª–∏ chunk > 500 tokens ‚Üí —Ä–∞–∑–±–∏—Ç—å –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
3. –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ > 500 tokens ‚Üí —Ä–∞–∑–±–∏—Ç—å –ø–æ —Å–ª–æ–≤–∞–º
4. –î–æ–±–∞–≤–∏—Ç—å 50-token overlap –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
5. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (source, position, page)
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```python
CHUNK_SIZE = 500        # tokens/words
CHUNK_OVERLAP = 50      # overlap between chunks
```

### 3.3 Embeddings (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–ú–æ–¥–µ–ª—å:** `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2`
- –†–∞–∑–º–µ—Ä: 384 dimensions
- –°–∫–æ—Ä–æ—Å—Ç—å: ~1000 —Ç–µ–∫—Å—Ç–æ–≤/—Å–µ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: —Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∫–∏—Ç–∞–π—Å–∫–∏–π –∏ –¥—Ä.
- –†–∞–∑–º–µ—Ä: ~130MB

**Pipeline:**
```
Text ‚Üí Tokenize ‚Üí Transformer ‚Üí 384D vector
```

### 3.4 Vector Storage (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–ë–î:** ChromaDB (embedded, persistent)

**–û–ø–µ—Ä–∞—Ü–∏–∏:**
```python
# –î–æ–±–∞–≤–∏—Ç—å chunks
await store.add_chunks(chunks)  # –° embeddings

# –ü–æ–∏—Å–∫
results = await store.search(query_embedding, top_k=5, threshold=0.3)

# –£–¥–∞–ª–∏—Ç—å
await store.delete(doc_id)
```

**–ú–µ—Ç—Ä–∏–∫–∞:** Cosine similarity (0 = –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ, 1 = –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ)

---

## 4Ô∏è‚É£ –ù–ï–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 4.1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------------|
| –ó–∞–≥—Ä—É–∑–∏—Ç—å 1MB PDF | < 5 —Å–µ–∫ |
| Embeddings (1 chunk) | ~100ms |
| –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ | < 200ms |
| Top 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | < 500ms total |
| 10,000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | < 2GB –ø–∞–º—è—Ç–∏ |

### 4.2 –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- –î–æ–∫—É–º–µ–Ω—Ç—ã: –î–æ 10,000
- Chunks: –î–æ 1,000,000
- –•—Ä–∞–Ω–∏–ª–∏—â–µ: ~1MB –Ω–∞ 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ü–∞–º—è—Ç—å: ~2GB –Ω–∞ 100,000 chunks

### 4.3 –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

- Uptime: 99.5%
- Persistence: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –¥–∏—Å–∫
- Recovery: Graceful degradation
- Backup: Manual export (future)

### 4.4 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –§–∞–π–ª—ã: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤
- ‚úÖ ZIP: Protection –æ—Ç zip bombs + path traversal
- ‚úÖ Encoding: –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (UTF-8, CP1251)
- ‚úÖ Input validation: –ù–∞ –≤—Å–µ—Ö —Ç–æ—á–∫–∞—Ö –≤—Ö–æ–¥–∞
- Future: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

## 5Ô∏è‚É£ –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö

### 5.1 –ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```
RAGException (–±–∞–∑–æ–≤–æ–µ)
  ‚îú‚îÄ FileProcessingError ‚úÖ
  ‚îú‚îÄ ChunkingError
  ‚îú‚îÄ EmbeddingError
  ‚îú‚îÄ VectorStoreError
  ‚îú‚îÄ RetrieverError
  ‚îú‚îÄ ConfigurationError
  ‚îî‚îÄ DocumentNotFoundError
```

### 5.2 –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

| –û—à–∏–±–∫–∞ | –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|-----------|----------|
| –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω | User error | Graceful fail |
| –û—à–∏–±–∫–∞ parsing | Retry smaller batch | Continue –∏–ª–∏ fail |
| –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–∫–∞ | Try Latin-1, CP1251 | Success –∏–ª–∏ fail |
| Memory exhausted | Batch processing | Success (slower) |
| Invalid config | Use defaults + warn | Continue |

---

## 6Ô∏è‚É£ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### 6.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü—É—Ç–∏
VECTOR_DB_PATH=./data/vector_db              # DB location
TEMP_DIR=./temp                              # Temp files

# Embeddings
EMBEDDING_MODEL=sentence-transformers/...   # Model name
EMBEDDING_DEVICE=auto                        # cpu/cuda/mps
EMBEDDING_BATCH_SIZE=32                      # Batch size

# Chunking
CHUNK_SIZE=500                               # Chunk size
CHUNK_OVERLAP=50                             # Overlap

# Retrieval
TOP_K_RESULTS=5                              # Max results
SIMILARITY_THRESHOLD=0.3                     # Min score

# Logging
DEBUG=false                                  # Debug mode
LOG_LEVEL=INFO                               # Logging level
```

---

## 7Ô∏è‚É£ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### 7.1 –ü–æ–∫—Ä—ã—Ç–∏–µ

- **File Processing:** >90% (–≥–æ—Ç–æ–≤–æ) ‚úÖ
- **Chunker:** >80% (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **Embeddings:** >80% (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **Vector Store:** >80% (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **Retriever:** >80% (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **Manager:** >85% (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **–ò—Ç–æ–≥–æ:** –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ >80%

### 7.2 –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**File Processing:**
- [x] PDF –ø–∞—Ä—Å–∏–Ω–≥
- [x] DOCX –ø–∞—Ä—Å–∏–Ω–≥ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
- [x] DOC –ø–∞—Ä—Å–∏–Ω–≥
- [x] XLSX/XLS –ø–∞—Ä—Å–∏–Ω–≥
- [x] TXT –ø–∞—Ä—Å–∏–Ω–≥
- [x] ZIP –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [x] Text cleaning
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–æ–∫
- [x] –û—à–∏–±–∫–∏ –∏ edge cases

---

## 8Ô∏è‚É£ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### 8.1 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- 2GB RAM –º–∏–Ω–∏–º—É–º
- 5GB –¥–∏—Å–∫ (–¥–ª—è 1000 docs)
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç (–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π)

### 8.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install -r rag_knowledge_base/requirements.txt
```

### 8.3 –ü—Ä–æ–≤–µ—Ä–∫–∞

```python
from rag_module.file_processing import FileConverter

converter = FileConverter()
print("‚úÖ File processing ready")
```

---

## 9Ô∏è‚É£ –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê

### –§–∞–∑–∞ 1 (–ù–µ–¥–µ–ª—è 1) ‚úÖ –ì–û–¢–û–í–û
- [x] File processing –ø–∞—Ä—Å–µ—Ä—ã (7 —Ñ–∞–π–ª–æ–≤)
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –§–∞–∑–∞ 2 (–ù–µ–¥–µ–ª—è 2) üîÑ
- [ ] Chunker —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] Embeddings —Å–µ—Ä–≤–∏—Å
- [ ] Vector store –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Retriever —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] Manager –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
- [ ] Unit —Ç–µ—Å—Ç—ã

### –§–∞–∑–∞ 3 (–ù–µ–¥–µ–ª—è 3)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TG_bot
- [ ] Handler —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Production hardening

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-21  
**–°–ª–µ–¥—É—é—â–∏–π review:** –ü–æ—Å–ª–µ –§–∞–∑—ã 1  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Project Owner

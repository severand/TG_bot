# üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º—Ç–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-20  
**–ê–≤—Ç–æ—Ä:** Uh Bot Team  
**–°—Ç–∞—Ç—É—Å:** Production Ready  

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º—Ç–æ–≤ (Prompt Management System)](#—Å–∏—Å—Ç–µ–º–∞-–ø—Ä–æ–º—Ç–æ–≤)
3. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (Document Processing Pipeline)](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
4. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞](#–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-–∑–∞–ø—Ä–æ—Å–∞)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-llm)
6. [–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
7. [Best Practices](#best-practices)
8. [–ü–æ–∏—Å–∫ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π](#–ø–æ–∏—Å–∫-–∏-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π)

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Telegram User Interface                     ‚îÇ
‚îÇ  /analyze | /chat | /homework | /prompts                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Handlers Layer (FSM)                          ‚îÇ
‚îÇ  ‚Ä¢ conversation.py     ‚Üí Document analysis                      ‚îÇ
‚îÇ  ‚Ä¢ chat.py             ‚Üí Dialog mode                            ‚îÇ
‚îÇ  ‚Ä¢ homework.py         ‚Üí Homework checking                      ‚îÇ
‚îÇ  ‚Ä¢ prompts.py          ‚Üí Prompt management                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚ñº              ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PromptMgr  ‚îÇ ‚îÇ FileConverter‚îÇ ‚îÇ  LLMFactory  ‚îÇ
‚îÇ             ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ
‚îÇ ‚Ä¢ Load      ‚îÇ ‚îÇ ‚Ä¢ Extract    ‚îÇ ‚îÇ ‚Ä¢ Replicate  ‚îÇ
‚îÇ ‚Ä¢ Get       ‚îÇ ‚îÇ ‚Ä¢ Parse      ‚îÇ ‚îÇ ‚Ä¢ OpenAI     ‚îÇ
‚îÇ ‚Ä¢ Update    ‚îÇ ‚îÇ ‚Ä¢ OCR        ‚îÇ ‚îÇ ‚Ä¢ Factory    ‚îÇ
‚îÇ ‚Ä¢ Category  ‚îÇ ‚îÇ ‚Ä¢ Validate   ‚îÇ ‚îÇ ‚Ä¢ Stream     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ               ‚îÇ                ‚îÇ
       ‚ñº               ‚ñº                ‚ñº
  ./data/prompts/  ./temp/files/    LLM APIs
```

---

## –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º—Ç–æ–≤

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø—Ä–æ–º—Ç–æ–≤

```
data/prompts/
‚îú‚îÄ‚îÄ document_analysis/
‚îÇ   ‚îú‚îÄ‚îÄ default.json
‚îÇ   ‚îú‚îÄ‚îÄ basic_analysis.json
‚îÇ   ‚îú‚îÄ‚îÄ summary.json
‚îÇ   ‚îú‚îÄ‚îÄ data_extraction.json
‚îÇ   ‚îú‚îÄ‚îÄ risk_analysis.json
‚îÇ   ‚îî‚îÄ‚îÄ legal_review.json
‚îú‚îÄ‚îÄ homework/
‚îÇ   ‚îú‚îÄ‚îÄ math_homework.json
‚îÇ   ‚îú‚îÄ‚îÄ russian_homework.json
‚îÇ   ‚îú‚îÄ‚îÄ english_homework.json
‚îÇ   ‚îú‚îÄ‚îÄ physics_homework.json
‚îÇ   ‚îú‚îÄ‚îÄ chemistry_homework.json
‚îÇ   ‚îú‚îÄ‚îÄ it_homework.json
‚îÇ   ‚îú‚îÄ‚îÄ geography_homework.json
‚îÇ   ‚îî‚îÄ‚îÄ literature_homework.json
‚îî‚îÄ‚îÄ chat/
    ‚îî‚îÄ‚îÄ chat_system.json
```

### üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ (JSON)

```json
{
  "name": "math_homework",
  "description": "üìê –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
  "category": "homework",
  "system_prompt": "–¢—ã –æ–ø—ã—Ç–Ω—ã–π —É—á–∏—Ç–µ–ª—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏...",
  "user_prompt_template": "–ü—Ä–æ–≤–µ—Ä—å —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ...",
  "examples": [
    {
      "input": "x + 5 = 10",
      "expected_output": "x = 5"
    }
  ],
  "version": "1.0.0",
  "created_at": "2025-12-20T19:15:00Z",
  "updated_at": "2025-12-20T19:15:00Z",
  "tags": ["education", "math", "homework"]
}
```

### üîå PromptManager API

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```python
from app.services.prompts.prompt_manager import PromptManager

pm = PromptManager()
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```python
# –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã
pm.load_user_prompts(user_id=123)
```

**2. –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç**
```python
prompt = pm.get_prompt(user_id=123, prompt_name="math_homework")
if prompt:
    system_prompt = prompt.system_prompt
    user_template = prompt.user_prompt_template
```

**3. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**
```python
# –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø–∞–º!
prompts_dict = pm.get_prompt_by_category(user_id=123, category="document_analysis")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"basic_analysis": Prompt(...), "summary": Prompt(...)}
```

**4. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```python
all_prompts = pm.list_prompts(user_id=123)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –ø—Ä–æ–º–ø—Ç—ã (–¥–æ–∫—É–º–µ–Ω—Ç—ã + –¥–æ–º–∞—à–∫–∞ + —á–∞—Ç)
```

**5. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç**
```python
pm.update_prompt(
    user_id=123,
    prompt_name="math_homework",
    system_prompt="–ù–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç",
    user_prompt_template="–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω"
)
```

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–º—Ç–æ–≤

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|-----------|----------|
| `document_analysis` | –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | 5+ |
| `homework` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–∫–∏ | 8 (–ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º) |
| `chat` | –î–∏–∞–ª–æ–≥ | 1 |

### ‚ö° –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π `get_prompt_by_category()` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏!**
   ```python
   # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   prompts = pm.get_prompt_by_category(user_id, "document_analysis")
   
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –≤–µ—Ä–Ω—ë—Ç –í–°–ï –ø—Ä–æ–º–ø—Ç—ã
   prompts = pm.list_prompts(user_id)
   ```

2. **–ó–∞–≥—Ä—É–∂–∞–π –ø—Ä–æ–º–ø—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º**
   ```python
   # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
   pm.load_user_prompts(user_id)  # 1. –ó–∞–≥—Ä—É–∑
   prompt = pm.get_prompt(user_id, name)  # 2. –ü–æ–ª—É—á–∏
   ```

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º—Ç–æ–≤**
   - –ü—Ä–æ–º–ø—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
   - –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π `update_prompt()` –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Å—å

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üì• Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
1. USER UPLOADS FILE
   ‚Üì
2. FILE VALIDATION
   ‚Ä¢ Check size (MAX_FILE_SIZE)
   ‚Ä¢ Check MIME type
   ‚Ä¢ Check format support
   ‚Üì
3. TEMPORARY STORAGE
   ‚Ä¢ Create temp directory
   ‚Ä¢ Download from Telegram
   ‚Ä¢ Store as: ./temp/{user_id}/{uuid}.{ext}
   ‚Üì
4. CONTENT EXTRACTION
   ‚Ä¢ PDF      ‚Üí pypdf
   ‚Ä¢ DOCX     ‚Üí python-docx
   ‚Ä¢ TXT      ‚Üí raw read
   ‚Ä¢ IMAGE    ‚Üí OCR.space API
   ‚Ä¢ ZIP      ‚Üí iterate & extract
   ‚Üì
5. TEXT VALIDATION
   ‚Ä¢ Check if text extracted
   ‚Ä¢ Validate length > 0
   ‚Ä¢ Trim whitespace
   ‚Üì
6. LLM PROCESSING
   ‚Ä¢ Select prompt by category
   ‚Ä¢ Build message context
   ‚Ä¢ Call LLM API
   ‚Üì
7. RESPONSE FORMATTING
   ‚Ä¢ Split long responses (4000 chars max)
   ‚Ä¢ Format as Markdown
   ‚Ä¢ Handle multipart messages
   ‚Üì
8. OUTPUT & CLEANUP
   ‚Ä¢ Send results to user
   ‚Ä¢ Delete temp files
   ‚Ä¢ Clear FSM state
```

### üîÑ FileConverter

```python
from app.services.file_processing.converter import FileConverter

converter = FileConverter()
text = converter.extract_text(file_path, temp_dir)
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**

| –§–æ—Ä–º–∞—Ç | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|--------|-----------|----------|
| PDF | pypdf | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö |
| DOCX | python-docx | Word 2007+ |
| TXT | built-in | UTF-8 encoding |
| JPG/PNG | OCR.space | –û–±–ª–∞—á–Ω—ã–π OCR |
| ZIP | zipfile | –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ |

### üåê OCR (Optical Character Recognition)

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä:** OCR.space  
**API Key:** `OCR_SPACE_API_KEY` (–≤ .env)  
**–õ–∏–º–∏—Ç:** 25,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)  

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
text = await _extract_text_from_photo_for_analysis(
    message=message,
    temp_dir=Path("./temp/user_123")
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã OCR:**
- `language`: "rus" (—Ä—É—Å—Å–∫–∏–π)
- `OCREngine`: 2 (–ª—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)
- `detectOrientation`: True
- `scale`: True
- `timeout`: 60 —Å–µ–∫

### üóëÔ∏è Cleanup Management

```python
from app.utils.cleanup import CleanupManager

# –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
temp_dir = CleanupManager.create_temp_directory(
    Path("./temp"),
    user_id=123
)

# –û—á–∏—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
await CleanupManager.cleanup_directory_async(temp_dir)
```

---

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (/analyze)

```mermaid
graph TD
    A[/analyze] --> B[Clear state]
    B --> C[Set ConversationStates.selecting_prompt]
    C --> D[Show prompt selection keyboard]
    D --> E[User clicks prompt]
    E --> F[Save prompt_name to state]
    F --> G[Set ConversationStates.ready]
    G --> H[Ask for document]
    H --> I[User uploads file]
    I --> J[Validate & extract text]
    J --> K[Load user prompts]
    K --> L[Get selected prompt]
    L --> M[Call LLM with<br/>document_text +<br/>system_prompt]
    M --> N[Format & send results]
    N --> O[Delete temp files]
    O --> P[Clear state]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–∫–∏ (/homework)

```mermaid
graph TD
    A[/homework] --> B[Clear state]
    B --> C[Set HomeworkStates.selecting_subject]
    C --> D[Show subjects keyboard]
    D --> E[User clicks subject]
    E --> F[Save subject to state]
    F --> G[Set HomeworkStates.waiting_for_file]
    G --> H[Ask for homework]
    H --> I[User uploads file/text]
    I --> J[Check state == waiting_for_file]
    J --> |Valid| K[Extract content]
    J --> |Invalid| L[Ignore message]
    K --> M[Get subject-specific prompt<br/>e.g., math_homework]
    M --> N[Call LLM with<br/>homework_content +<br/>subject_prompt]
    N --> O[Format & send results]
    O --> P[Delete temp files]
    P --> Q[Clear state]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–∏–∞–ª–æ–≥ (/chat)

```mermaid
graph TD
    A[/chat] --> B[Clear state]
    B --> C[Set ChatStates.chatting]
    C --> D[User sends message]
    D --> E[Check state == ChatStates.chatting]
    E --> |Valid| F[Load user prompts]
    E --> |Invalid| G[Ignore message]
    F --> H[Get chat_system prompt]
    H --> I[Call LLM with<br/>user_message +<br/>system_prompt]
    I --> J[Format & send response]
    J --> K{Message length}
    K --> |Single| L[Send 1 message]
    K --> |Multiple| M[Split & send chunks]
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM

### ü§ñ LLMFactory

```python
from app.services.llm.llm_factory import LLMFactory
from app.config import get_settings

config = get_settings()

llm_factory = LLMFactory(
    primary_provider=config.LLM_PROVIDER,  # "replicate" –∏–ª–∏ "openai"
    replicate_api_token=config.REPLICATE_API_TOKEN,
    replicate_model=config.REPLICATE_MODEL,
    openai_api_key=config.OPENAI_API_KEY,
    openai_model=config.OPENAI_MODEL,
)
```

### üìû –ú–µ—Ç–æ–¥—ã LLM

**1. –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**
```python
result = await llm_factory.analyze_document(
    document_text="...",
    analysis_command="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π...",
    system_prompt="–¢—ã —ç–∫—Å–ø–µ—Ä—Ç...",
    use_streaming=False,
)
```

**2. –î–∏–∞–ª–æ–≥/—á–∞—Ç**
```python
response = await llm_factory.chat(
    user_message="–ß—Ç–æ —Ç–∞–∫–æ–µ Python?",
    system_prompt="–ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è...",
    use_streaming=False,
)
```

### üîå –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ú–æ–¥–µ–ª—å | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ |
|-----------|--------|-------------|----------|
| **Replicate** | Llama 2, Claude | –î–µ—à–µ–≤–æ, –±—ã—Å—Ç—Ä–æ, –º–æ—â–Ω–æ | –ò–Ω–æ–≥–¥–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ |
| **OpenAI** | GPT-4, GPT-3.5 | –ö–∞—á–µ—Å—Ç–≤–æ, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å | –î–æ—Ä–æ–∂–µ |

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–§–∞–π–ª: `docs/TECHNOLOGY_PROMPTS_AND_DOCUMENTS.md` (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç)**

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ø—Ä–æ–º–ø—Ç–∞
```json
// data/prompts/document_analysis/sentiment_analysis.json
{
  "name": "sentiment_analysis",
  "description": "üí≠ –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏",
  "category": "document_analysis",
  "system_prompt": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞.",
  "user_prompt_template": "–û–ø—Ä–µ–¥–µ–ª–∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è/–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞—è/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è).",
  "version": "1.0.0"
}
```

#### –®–∞–≥ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- PromptManager —Å–∫–∞–Ω–∏—Ä—É–µ—Ç `data/prompts/` –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
- –ü—Ä–æ–º–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `/analyze`
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ –¥–æ–º–∞—à–∫—É

#### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ SubjectCheckers
```python
# app/services/homework/subject_checkers.py
SUBJECT_SPANISH = Subject(
    code="spanish",
    name="–ò—Å–ø–∞–Ω—Å–∫–∏–π —è–∑—ã–∫",
    emoji="üá™üá∏",
    description="–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–∞–Ω—Å–∫–æ–≥–æ —è–∑—ã–∫–∞",
)
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç
```json
// data/prompts/homework/spanish_homework.json
{
  "name": "spanish_homework",
  "description": "üá™üá∏ –ò—Å–ø–∞–Ω—Å–∫–∏–π —è–∑—ã–∫",
  "category": "homework",
  "system_prompt": "–¢—ã –æ–ø—ã—Ç–Ω—ã–π —É—á–∏—Ç–µ–ª—å –∏—Å–ø–∞–Ω—Å–∫–æ–≥–æ —è–∑—ã–∫–∞...",
  "user_prompt_template": "–ü—Ä–æ–≤–µ—Ä—å —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∏—Å–ø–∞–Ω—Å–∫–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è..."
}
```

#### –®–∞–≥ 3: –ì–æ—Ç–æ–≤–æ!
- –ü—Ä–µ–¥–º–µ—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –º–µ–Ω—é `/homework`
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç `spanish` ‚Üí `spanish_homework.json`

### –ü—Ä–∏–º–µ—Ä 3: –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

```python
from app.services.prompts.prompt_manager import PromptManager

pm = PromptManager()
pm.load_user_prompts(user_id=123)

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç"
pm.update_prompt(
    user_id=123,
    prompt_name="math_homework",
    system_prompt="–ù–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    user_prompt_template="–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω"
)

# –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –±–µ—Ä—ë—Ç
# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç, –∞ –Ω–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
prompt = pm.get_prompt(123, "math_homework")
# prompt.system_prompt == "–ù–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
```

---

## Best Practices

### ‚úÖ DO's

1. **–í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–π –ø—Ä–æ–º–ø—Ç—ã –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º**
   ```python
   pm.load_user_prompts(user_id)
   prompt = pm.get_prompt(user_id, name)
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**
   ```python
   # –î–ª—è /analyze - –¢–û–õ–¨–ö–û –¥–æ–∫—É–º–µ–Ω—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
   docs = pm.get_prompt_by_category(user_id, "document_analysis")
   
   # –î–ª—è /homework - –¢–û–õ–¨–ö–û –¥–æ–º–∞—à–Ω–∏–µ –ø—Ä–æ–º–ø—Ç—ã
   hw = pm.get_prompt_by_category(user_id, "homework")
   ```

3. **–ü—Ä–æ–≤–µ—Ä—è–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π**
   ```python
   current_state = await state.get_state()
   if current_state != ExpectedState.waiting.state:
       return  # –ò–≥–Ω–æ—Ä–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ
   ```

4. **–û—á–∏—â–∞–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏**
   ```python
   await state.clear()  # –°–ù–ê–ß–ê–õ–ê
   await state.set_state(NewState)  # –ü–û–¢–û–ú
   ```

5. **–í—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–π –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**
   ```python
   try:
       # –æ–±—Ä–∞–±–æ—Ç–∫–∞
   finally:
       if temp_dir.exists():
           await CleanupManager.cleanup_directory_async(temp_dir)
   ```

6. **–õ–æ–≥–∏—Ä—É–π –≤—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π**
   ```python
   logger.info(f"User {user_id} set state to {new_state}")
   logger.debug(f"Loaded {len(prompts)} prompts for user {user_id}")
   ```

### ‚ùå DON'Ts

1. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `list_prompts()` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**
   ```python
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
   all_prompts = pm.list_prompts(user_id)
   # –í–µ—Ä–Ω—ë—Ç —Å–º–µ—à–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   ```

2. **–ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏**
   ```python
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
   await state.set_state(NewState)
   
   # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
   await state.clear()
   await state.set_state(NewState)
   ```

3. **–ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   ```python
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   @router.message(F.text)
   async def handle(message):
       pass
   
   # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
   @router.message(ExpectedState.waiting, F.text)
   async def handle(message):
       pass
   ```

4. **–ù–µ –∑–∞–±—ã–≤–∞–π —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**
   ```python
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
   async def process(message):
       temp_file = Path("./temp/file.pdf")
       # –æ–±—Ä–∞–±–æ—Ç–∫–∞
       # –ë–ï–ó –û–ß–ò–°–¢–ö–ò!
   ```

5. **–ù–µ —Å–º–µ—à–∏–≤–∞–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–º—Ç–æ–≤ –≤ UI**
   ```python
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å—ë –ø–æ–¥—Ä—è–¥
   for name in pm.list_prompts(user_id):
       add_button(name)
   
   # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
   for name in pm.get_prompt_by_category(user_id, "document_analysis"):
       add_button(name)
   ```

---

## –ü–æ–∏—Å–∫ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### üêõ –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

**ÁóáÁä∂:**
```python
prompt = pm.get_prompt(user_id, "math_homework")
# None
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ü—Ä–æ–º–ø—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω (`load_user_prompts()` –Ω–µ –≤—ã–∑–≤–∞–Ω)
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø—Ä–æ–º–ø—Ç–∞ (–ø—Ä–æ–≤–µ—Ä—å `prompt.name` –≤ JSON)
3. –§–∞–π–ª –Ω–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```python
# 1. –ü—Ä–æ–≤–µ—Ä—å –∑–∞–≥—Ä—É–∑–∫—É
pm.load_user_prompts(user_id)
logger.debug(f"Available prompts: {pm.list_prompts(user_id).keys()}")

# 2. –ü—Ä–æ–≤–µ—Ä—å –∏–º—è
all_prompts = pm.list_prompts(user_id)
print(all_prompts)  # –í—ã–≤–µ–¥–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ

# 3. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª
import os
os.listdir("./data/prompts/homework/")  # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å math_homework.json
```

### üêõ –ü—Ä–æ–±–ª–µ–º–∞: –°–º–µ—à–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ UI

**ÁóáÁä∂:**
–í `/analyze` –≤–∏–¥–Ω—ã –∫–Ω–æ–ø–∫–∏ "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–§–∏–∑–∏–∫–∞" (—ç—Ç–æ –∏–∑ homework)

**–ü—Ä–∏—á–∏–Ω–∞:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
prompts = pm.list_prompts(user_id)  # –í–µ—Ä–Ω—ë—Ç –í–°–ï
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
prompts = pm.get_prompt_by_category(user_id, "document_analysis")
```

### üêõ –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (–æ—à–∏–±–∫–∞ #1)

**ÁóáÁä∂:**
–ß—Ç–æ-—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (homework –∫–∞–∫ chat)

**–ü—Ä–∏—á–∏–Ω–∞:**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
await state.set_state(HomeworkState)
await state.set_state(ChatState)  # –ö–æ–Ω—Ñ–ª–∏–∫—Ç!
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
await state.clear()  # –°–ù–ê–ß–ê–õ–ê –æ—á–∏—Å—Ç–∏—Ç—å
await state.set_state(ChatState)  # –ü–û–¢–û–ú —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```

### üêõ –ü—Ä–æ–±–ª–µ–º–∞: –§–∞–π–ª—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

**ÁóáÁä∂:**
`./temp/` —Ä–∞—Å—Ç—ë—Ç –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ

**–ü—Ä–∏—á–∏–Ω–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç cleanup –≤ finally –±–ª–æ–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
```python
temp_dir = None
try:
    temp_dir = CleanupManager.create_temp_directory(...)
    # –æ–±—Ä–∞–±–æ—Ç–∫–∞
finally:
    if temp_dir and temp_dir.exists():
        await CleanupManager.cleanup_directory_async(temp_dir)
```

### üêõ –ü—Ä–æ–±–ª–µ–º–∞: OCR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**ÁóáÁä∂:**
–§–æ—Ç–æ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `echo $OCR_SPACE_API_KEY`
2. –§–æ—Ç–æ –≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ (–Ω–µ —Ä–∞–∑–º—ã—Ç–æ, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ–µ)
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `logger.info(f"OCR: ...")`
4. –£–≤–µ–ª–∏—á—å timeout: `timeout=httpx.Timeout(60.0, connect=30.0)`

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ OCR
logger.info(f"OCR: Starting extraction")
logger.info(f"OCR: Response keys: {result.keys()}")
logger.info(f"OCR: Successfully extracted {len(text)} chars")
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [README.md](../README.md) - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Architecture Diagram](./ARCHITECTURE.md) - –î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [API Documentation](./API.md) - –ü–æ–ª–Ω–∞—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Deployment Guide](./DEPLOYMENT.md) - –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

---

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|--------|------|----------|
| 1.0.0 | 2025-12-20 | –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |

---

## ‚ùì FAQ

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞?**  
A: –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å JSON —Ñ–∞–π–ª –≤ `data/prompts/document_analysis/`. PromptManager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –µ–≥–æ!

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤?**  
A: –î–∞, –Ω–æ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ. –≠—Ç–æ –¥–∞—ë—Ç –±–æ–ª—å—à–µ –≥–∏–±–∫–æ—Å—Ç–∏ –ø—Ä–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏.

**Q: –ß—Ç–æ –µ—Å–ª–∏ OCR.space API —É–ø–∞–¥—ë—Ç?**  
A: –¢–µ–∫—Å—Ç –∏–∑ —Ñ–æ—Ç–æ –Ω–µ –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω. –î–æ–±–∞–≤—å fallback –Ω–∞ –¥—Ä—É–≥–æ–π OCR —Å–µ—Ä–≤–∏—Å –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å.

**Q: –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?**  
A: –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤–∞—è. –î–ª—è –º–∞—Å—à—Ç–∞–±–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ë–î (PostgreSQL) –≤–º–µ—Å—Ç–æ JSON —Ñ–∞–π–ª–æ–≤.

---

**–î–æ–∫—É–º–µ–Ω—Ç –∞–∫—Ç—É–∞–ª–µ–Ω –Ω–∞:** 2025-12-20  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
